<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ¤ Transcription vocale locale (Whisper)</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 30px auto; }
    button { margin: 10px 0; padding: 10px 20px; font-size: 16px; cursor: pointer; }
    #result { white-space: pre-wrap; background: #f7f7f7; padding: 10px; border-radius: 6px; }
  </style>
</head>
<body>
  <h2>ğŸ™ï¸ Parler au micro et obtenir la transcription</h2>

  <button id="recordBtn">âºï¸ DÃ©marrer l'enregistrement</button>
  <button id="stopBtn" disabled>â¹ï¸ Stop</button>

  <h3>ğŸ“ RÃ©sultat :</h3>
  <div id="result">Aucune transcription pour l'instant...</div>

  <script>
    let mediaRecorder;
    let audioChunks = [];

    const recordBtn = document.getElementById('recordBtn');
    const stopBtn = document.getElementById('stopBtn');
    const resultDiv = document.getElementById('result');

    recordBtn.addEventListener('click', async () => {
      // Demande l'autorisation micro
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);

      audioChunks = [];
      mediaRecorder.ondataavailable = event => {
        audioChunks.push(event.data);
      };

      mediaRecorder.onstop = async () => {
        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
        const formData = new FormData();
        formData.append('file', audioBlob, 'recording.webm');

        resultDiv.textContent = 'â³ Transcription en cours...';

        try {
          const response = await fetch('https://bffc9b7e6871.ngrok-free.app/transcribe', {
            method: 'POST',
            body: formData
          });
          const data = await response.json();
          resultDiv.textContent = data.text || '(Aucune transcription)';
        } catch (err) {
          console.error(err);
          resultDiv.textContent = 'âŒ Erreur lors de la transcription';
        }
      };

      mediaRecorder.start();
      recordBtn.disabled = true;
      stopBtn.disabled = false;
      resultDiv.textContent = 'ğŸ¤ Enregistrement en cours...';
    });

    stopBtn.addEventListener('click', () => {
      mediaRecorder.stop();
      recordBtn.disabled = false;
      stopBtn.disabled = true;
    });
  </script>
</body>
</html>
